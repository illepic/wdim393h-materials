<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>WDIM393 - Week 9</title>

  <meta name="description" content="A jQuery library for modern HTML presentations">
  <meta name="author" content="Caleb Troughton">
  <meta name="viewport" content="width=1024, user-scalable=no">

  <!-- Core and extension CSS files -->
  <link rel="stylesheet" href="../deck.js/core/deck.core.css">
  <link rel="stylesheet" href="../deck.js/extensions/goto/deck.goto.css">
  <link rel="stylesheet" href="../deck.js/extensions/menu/deck.menu.css">
  <link rel="stylesheet" href="../deck.js/extensions/navigation/deck.navigation.css">
  <link rel="stylesheet" href="../deck.js/extensions/status/deck.status.css">
  <link rel="stylesheet" href="../deck.js/extensions/hash/deck.hash.css">

  <!-- Theme CSS files (menu swaps these out) (or did until we modified) -->
  <link rel="stylesheet" id="style-theme-link" href="../deck.js/themes/style/web-2.0-wdim.css">
  <link rel="stylesheet" id="transition-theme-link" href="../deck.js/themes/transition/vertical-slide.css">

  <!-- syntax highlighter -->
  <link rel="stylesheet" href="../custom-common/css/jquery.snippet.css">

  <!-- Custom CSS for all AI classes -->
  <link rel="stylesheet" href="../custom-common/css/custom-common.css">
  <!-- Custom CSS just for this page -->
  <link rel="stylesheet" href="ai-class.css">
  <link rel='stylesheet' media='screen and (min-width: 701px) and (max-width: 900px)' href='demo.css' />

  <script src="../deck.js/modernizr.custom.js"></script>
</head>

<body class="deck-container class-3">

  <section class="slide" id="title-slide">
    <h1>WDIM363 - Week 9</h1>
  </section>

  <section class="slide" id="agenda">
    <h2>Agenda</h2>
    <h3>Advanced Canvas</h3>
    <ol>
      <li>Translate</li>
      <li>Rotate</li>
      <li>Scale</li>
      <li>State saving</li>
      <li>Pixel buffers</li>
      <li>Events</li>
      <li>Animation</li>
    </ol>
  </section>

  <section class="slide" id="translate">
    <h2>Just like CSS3</h2>
    <ul>
      <li><strong>Translate</strong></li>
      <li>Rotate</li>
      <li>Scale</li>
    </ul>
    <p>If we have to position many shapes, we can translate from the prior shape.</p>
    <figure class="fiddle">
      <iframe style="width: 580px; height: 350px" src="http://jsfiddle.net/illepic/5AQ3m/embedded/js,result" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
    </figure>
    <figure class="fiddle">
      <iframe style="width: 580px; height: 350px" src="http://jsfiddle.net/illepic/5AQ3m/embedded/result" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
    </figure>
  </section>

  <section class="slide" id="rotate">
    <h2>Just like CSS3 (kind of)</h2>
    <ul>
      <li>Translate</li>
      <li><strong>Rotate</strong></li>
      <li>Scale</li>
    </ul>
    <img src="images/radian.png" alt="" style="float:left;"><p>To rotate the HTML5 Canvas, we can use the rotate() method. The rotate transformation is defined by an angle in radians.</p>
    <p><a href="http://en.wikipedia.org/wiki/Radian">A radian is the ratio between the length of an arc and it's radius</a>. To use degrees, multiply by &Pi;/180.</p>
    <div class="clearleft"></div>
    <figure class="fiddle">
      <iframe style="width: 580px; height: 350px" src="http://jsfiddle.net/illepic/QLBQE/embedded/js,result" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
    </figure>
    <figure class="fiddle">
      <iframe style="width: 580px; height: 350px" src="http://jsfiddle.net/illepic/QLBQE/embedded/result" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
    </figure>
  </section>

  <section class="slide" id="scale">
    <h2>Just like CSS3 (kind of)</h2>
    <ul>
      <li>Translate</li>
      <li>Rotate</li>
      <li><strong>Scale</strong></li>
    </ul>
    <p>Scale is pretty straightforward: <code>context.scale(scaleX,scaleY);</code></p>
    <figure class="fiddle">
      <iframe style="width: 580px; height: 350px" src="http://jsfiddle.net/illepic/AJfT6/embedded/js,result" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
    </figure>
    <figure class="fiddle">
      <iframe style="width: 580px; height: 350px" src="http://jsfiddle.net/illepic/AJfT6/embedded/result" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
    </figure>
  </section>

  <section class="slide" id="states">
    <h2>State saving</h2>
    <p>Each time you call translate, rotate, or scale it adds on to the previous transformation. This gets really hard to track after awhile.</p>
    <blockquote>The context object represents the current drawing state. The state includes the current transform, the fill and stroke color, the current font, and a few other variables. Canvas lets you save this state by pushing it onto a "stack". After you save the state you can make modifications, then restore to the previous state. Canvas takes care of the book-keeping for you.</blockquote>
    <p>Notice how the disance between rectangles does not expand, but rather stays linear.</p>
    <figure class="fiddle">
      <iframe style="width: 580px; height: 350px" src="http://jsfiddle.net/illepic/swtNb/embedded/js,result" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
    </figure>
    <figure class="fiddle">
      <iframe style="width: 580px; height: 350px" src="http://jsfiddle.net/illepic/swtNb/embedded/result" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
    </figure>
    <cite>joshy.org</cite>
  </section>

  <section class="slide" id="pixel-buffers">
    <h2>Pixel buffers</h2>
    <p>With canvas, we can get right at the pixels directly and manipulate them. We can create our own image data, or play with existing photo data. </p>
    <p>Thinks of pixel buffers as essentially a huge array of all the pixels in an image. The pixels are made up of red, green, blue, and alpha components, in that order, so to calculate the index of the <span class="red">red</span> component of a particular pixel you would have to calculate the following equation:</p>
    <code>
      <pre>(y * width + x) * 4</pre>
    </code>
    <p>For the pixel 5,3 on a bitmap that is 6 pixels wide it would be:</p>
    <code>
       <pre>(3 * 6 + 5) * 4</pre>
     </code>
     <p>The * 4 is because each pixel has four color components (RGB and the opacity or 'alpha' component). The data object contains the width of the image, so you can write it as (3 * data.width + 5) * 4. Once you have found the red component you can find the others by incrementing the index for the green, blue, and alpha components. (code on next slide)</p>
     <img src="images/pixel-array.png">
    <cite>joshy.org</cite>
  </section>

  <section class="slide" id="pixel-buffers-ex">
    <h2>Pixel buffers Example</h2>
    <p>In the following example, we're looping through all the pixels in the image and inverting them.</p>
    <code>
      <pre class="jsCode">var img = new Image();
$(img).load(function(){
  var c = $(&#039;#pixel-buffers-ex canvas&#039;).get(0).getContext(&#039;2d&#039;);
  c.drawImage(img,0,0); //draw initial image
  var data = c.getImageData(0,0,img.width,img.height); //get the canvas data
  //invert each pixel by looping through array and subtracting from 255
  for(n=0; n&lt;data.width*data.height; n++){
    var index = n*4; //jumps to next point in array after 4 colors
    data.data[index]   = 255-data.data[index]; //red
    data.data[index+1] = 255-data.data[index+1]; //green
    data.data[index+2] = 255-data.data[index+2]; //blue
    // alpha (skipping)
  }
  c.putImageData(data,500,0); //set the recolored data back
});
img.src = &quot;images/fire.jpg&quot;;</pre>
    </code>

    <canvas width="1000" height="500"></canvas>
  </section>

  <section class="slide" id="events">
    <h2>Events</h2>
    <p>We have to define our own event inside of canvas. <code>isPointInPath</code> does the heavy lifting for us. Use the console of your browser to see the javascript output.</p>
    <code>
      <pre class="jsCode">var c = $(&#039;#events canvas&#039;).get(0).getContext(&#039;2d&#039;);
c.beginPath();
c.arc(
  100, 100, 40,  //40 pix radius circle at 100,100
  0, Math.PI*2  //0 to 360 degrees for a full circle
);
c.closePath();
c.stroke();
var a = c.isPointInPath(110,110);
console.log(&#039;Is point 110,110 in the circle? &#039; + a);// returns true
var b = c.isPointInPath(200,100);
console.log(&#039;Is point 200,11 in the circle? &#039; + b);  // returns false</pre>
    </code>
    <canvas width="1000" height="250"></canvas>
  </section>

  <section class="slide" id="animation-1">
    <h2>Animation</h2>
    <p>To animate on a canvas, think about it like drawing something over and over again. When you call a draw function, it is immediately put on the screen. Basically, after drawing something, wait a few milliseconds and then draw something else. We "ask" the browser to call us back after those few milliseconds and then draw another thing. Javascript gives us setInterval to make these repeated calls.</p>
    <code>
      <pre class="jsCode">var c3 = $(&#039;#animation-1 canvas&#039;).get(0).getContext(&#039;2d&#039;);
c3.fillStyle = &quot;red&quot;;
var x = 0;
function drawIt() {
  c3.fillRect(x,50,200,100);
  x+=5;
  // stop the timer once it&#039;s beyond the canvas
  if(x &gt; c3.canvas.width){
    clearInterval(intervalID);
  }
}
var intervalID = setInterval(drawIt, 100);</pre>
    </code>
    <canvas width="1000" height="250"></canvas>
  </section>

  <section class="slide" id="animation-2">
    <h2>Animation - Clearing</h2>
    <p>Why was the previous example a solid bar instead of an animated box? Actually, our rectangle did go across the screen, updating by five pixels every 100 millesconds (or 10FPS), but the old rectangle is still there. It looks like the rectangle is just getting longer and longer.</p>
    <p>Remember that the canvas is just a pixel buffer. If you set some pixels they will stay there until you change them. So lets clear the canvas on each frame before we draw the rectangle with clearRect().</p>
    <code>
      <pre class="jsCode">var c4 = $(&#039;#animation-2 canvas&#039;).get(0).getContext(&#039;2d&#039;);
c4.fillStyle = &quot;red&quot;;
var x2 = 0;
function drawIt2() {
  c4.fillRect(x,50,200,100);
  //nuke it from orbit, it&#039;s the only way to be sure
  c4.clearRect(0,0,c4.canvas.width,c4.canvas.height);
  x2+=5;
  // stop the timer once it&#039;s beyond the canvas
  if(x2 &gt; c4.canvas.width){
    clearInterval(intervalID);
  }
}
var intervalID2 = setInterval(drawIt2, 100);</pre>
    </code>
    <canvas width="1000" height="250"></canvas>
  </section>

  <section class="slide" id="animation-3">
    <h2>Animation - Sprites (still)</h2>
    <p>Most 8-bit and 16-bit video game consoles relied soley on sprites for animation. Sprites are small images that draw quickly on the screen with little overhead. Sprites are usually "cut" out of a larger image called a sprite sheet.</p>
    <p>Think about it like a flip book: The sprite contains all the different images and we just flip through each one. See the example below.</p>
    <img src="images/explode.png" alt="">
    <p>Let's draw just the third image from left.</p>
    <code>
      <pre class="jsCode">  var img2 = new Image();
  $(img2).load(function(){
    var c5 = $(&#039;#animation-3 canvas&#039;).get(0).getContext(&#039;2d&#039;);
    c5.drawImage(
      img2,       // the image of the sprite sheet
      96,0,48,48, // source coords inside sheet (x,y,w,h)
      0,0,48,48   // destination coordinates on canvas (x,y,w,h)
    );
  });
  img2.src = &quot;images/explode.png&quot;;</pre>
    </code>
    <canvas width="1000" height="100"></canvas>
  </section>

  <section class="slide" id="animation-4">
    <h2>Animation - Sprites (animated)</h2>
    <p>Think about it like a flip book: The sprite contains all the different images and we just flip through each one.</p>
    <img src="images/explode.png" alt="">
    <p>Let's flip through it. We'll do this by keeping track of the current frame using a tick counter.</p>
    <code>
      <pre class="jsCode">  var tick = 0; //every time we redraw, we&#039;ll increment this
  var c6 = $(&#039;#animation-4 canvas&#039;).get(0).getContext(&#039;2d&#039;);
  var img3 = new Image();
  $(img3).load(function(){
    function drawIt3() {
      var frame = tick % 7; //7 is the number of frames in the sprite sheet
      var x3 = frame * 48; //48 is the width of each frame
      c6.clearRect(0,0,c6.canvas.width,c6.canvas.height);
      c6.drawImage(
        img3,       // the image of the sprite sheet
        x3,0,48,48, // source coords inside sheet (x,y,w,h)
        0,0,48,48   // destination coordinates on canvas (x,y,w,h)
      );
      tick++;
    }
    var intervalID3 = setInterval(drawIt3, 100);
  });
  img3.src = &quot;images/explode.png&quot;;</pre>
    </code>
    <canvas width="1000" height="100"></canvas>
  </section>

  <section class="slide" id="lab">
    <h2>Hands on lab from joshy.org</h2>
    <p><a href="http://projects.joshy.org/presentations/HTML/CanvasDeepDive/handson2/handson2.html">Click here for an advanced HTML5 hands on lab.</a></p>
    <p><a href="lab/lab.zip">Zip of lab materials.</a></p>
    <p>Each class member will complete this assignment and turn in the html files via links online using the class website. DO NOT EMAIL ME HTML FILES. Get your file online and use the homework submission system to turn in the LINK to your file.</p>
    <p>(Bonus canvas game lab, using jQuery:<a href="http://www.html5rocks.com/en/tutorials/canvas/notearsgame/">http://www.html5rocks.com/en/tutorials/canvas/notearsgame/</a>)</p>
  </section>

  <section class="slide" id="job">
    <h2>Freelance Gig</h2>
    <p>A film company with a movie about to be shown in festivals needs a site built for their firm as well as for the movie itself. They are looking for comps for 5-6 individual pages per site. They are paying $1,000 for just the design, no code involved.</p>
    <p>Please email me with a link to your design portfolio if you are interested. This is a great way to show of some real work and the pay isn't bad.</p>
  </section>

  <section class="slide" id="resources">
    <h2>Resources</h2>
    <p>There are many canvas animation resources out there. Below are a few you might find helpful.</p>
    <ul>
      <li><a href="http://mbostock.github.com/d3/">D3.js is really handy for data visualization.</a></li>
      <li><a href="http://impactjs.com/">Impact.js is a full game engine</a></li>
      <li><a href="http://createjs.com/">Create.js (includes easel.js): VERY nice api for animation</a></li>
      <li><a href="http://paperjs.org/">Paper.js: vector animation using paperscript</a></li>
      <li><a href="http://processingjs.org/">Processing.js: very neat data visualization and animation</a></li>
    </ul>
  </section>

  <a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
  <a href="#" class="deck-next-link" title="Next">&#8594;</a>

  <p class="deck-status">
    Press "m" to see all slides.
    <span class="deck-status-current"></span>
    /
    <span class="deck-status-total"></span>
  </p>

  <form action="." method="get" class="goto-form">
    <label for="goto-slide">Go to slide:</label>
    <input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
    <datalist id="goto-datalist"></datalist>
    <input type="submit" value="Go"></form>

  <a href="." title="Permalink to this slide" class="deck-permalink">#</a>
<!-- Grab CDN jQuery, with a protocol relative URL; fall back to local if offline -->
  <script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.min.js"></script>
  <script>window.jQuery || document.write('<script src="../deck.js/jquery-1.7.min.js"><\/script>')</script>
<!-- Deck Core and extensions -->
<script src="../deck.js/core/deck.core.js"></script>
<script src="../deck.js/extensions/hash/deck.hash.js"></script>
<script src="../deck.js/extensions/menu/deck.menu.js"></script>
<script src="../deck.js/extensions/goto/deck.goto.js"></script>
<script src="../deck.js/extensions/status/deck.status.js"></script>
<script src="../deck.js/extensions/navigation/deck.navigation.js"></script>
<!-- syntax highlighter -->
<script src="../custom-common/js/jquery.snippet.js"></script>
<!-- Specific to this page -->
<script src="ai-class.js"></script>

</body>
</html>
